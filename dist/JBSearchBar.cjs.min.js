'use strict';function _interopDefault(a){return a&&"object"==typeof a&&"default"in a?a["default"]:a}var React=_interopDefault(require("react")),mobx=require("mobx"),JBSelectBoxData=_interopDefault(require("jb-selectbox-react/dist/JBSelectBoxData.cjs.min")),JBSelectBox=_interopDefault(require("jb-selectbox-react/dist/JBSelectBox.cjs.min")),mobxReact=require("mobx-react");require("./JBSearchBar.css");var _class,_descriptor,_temp,JBDateInput=_interopDefault(require("jb-dateinput-react/dist/JBDateInput.cjs.min"));function _initializerDefineProperty(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _applyDecoratedDescriptor(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var _class$1,_descriptor$1,_descriptor2,_descriptor3,_temp$1,JBSearchBarData=(_class=(_temp=function(){function a(){_classCallCheck(this,a),this.typesArray=[{name:"number"},{name:"text"},{name:"date"},{name:"list"}],_initializerDefineProperty(this,"columns",_descriptor,this),this.triggers={focus:void 0,injectFilter:void 0},this.callBacks={onChange:void 0,oncolumnSelect:void 0,onHeightOverflow:void 0,onHeightChange:void 0},this.searchOnChange=!0,this.captions={unknownSelectedOptionCaption:"\u0633\u062A\u0648\u0646 \u0646\u0627\u0645\u0634\u062E\u0635",unknownSelectedOptionValue:"\u0645\u0642\u062F\u0627\u0631 \u0646\u0627 \u0645\u0634\u062E\u0635"},this.value=[],this.defaultValues=[]}return _createClass(a,[{key:"checkColumnsValidation",value:function(){}}]),a}(),_temp),_descriptor=_applyDecoratedDescriptor(_class.prototype,"columns",[mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_class);function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _objectSpread(a){for(var b=1;b<arguments.length;b++){var c=null==arguments[b]?{}:arguments[b],d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){_defineProperty(a,b,c[b])})}return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _initializerDefineProperty$1(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function _classCallCheck$1(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass$1(a,b,c){return b&&_defineProperties$1(a.prototype,b),c&&_defineProperties$1(a,c),a}function _applyDecoratedDescriptor$1(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var _class$2,JBSearchBarService=(_class$1=(_temp$1=function(){function a(b){var c=this;_classCallCheck$1(this,a),this.columnSelectConfig=new JBSelectBoxData,_initializerDefineProperty$1(this,"intentColumn",_descriptor$1,this),_initializerDefineProperty$1(this,"intentValue",_descriptor2,this),_initializerDefineProperty$1(this,"filterList",_descriptor3,this),this.defaultConfig=new JBSearchBarData,this.config=null,this.elements={spinnerLine:React.createRef(),spinnerBox:React.createRef(),valueTextInput:React.createRef(),valueNumberInput:React.createRef(),valueDateInput:React.createRef(),valueListInput:React.createRef(),filterDynamicWrapper:React.createRef(),filterInputWrapper:React.createRef()},this.onSearch=null,this.isLoading=!1,this.searchBarHeight=45,this._isComponentMounted=!1,this.onSearch=b.onSearch||this.onLackofOnSearch,this.config=this.mergeObject(b.config,this.defaultConfig),this.filterList=this.config.value,this.columnSelectConfig.options=this.config.columns,this.columnSelectConfig.placeHolder="\u0641\u06CC\u0644\u062F \u062C\u0633\u062A\u062C\u0648 \u0631\u0627 \u0645\u0634\u062E\u0635 \u06A9\u0646\u06CC\u062F",this.columnSelectConfig.allowNull=!1,this.config.triggers.focus=function(){c.searchBarFocus()},this.config.triggers.injectFilter=function(a){c.injectFilterToList(a)},this.implementDefualtFilterValues()}return _createClass$1(a,[{key:"onComponentDidMount",value:function(){this._isComponentMounted=!0,this.manageHiddenColumn()}},{key:"onLackofOnSearch",value:function(){console.warn("there is no \"onSearch\" prop defined for jb-searchbar and its wierd! ")}},{key:"implementDefualtFilterValues",value:function(){var a=this;this.config.defaultValues.forEach(function(b,c,d){var e=c==d.length-1;a.injectFilterToList(b,e)})}},{key:"mergeObject",value:function(a,b){var c={};for(var d in b)(null==a[d]||null==a[d])&&(c[d]=b[d]);return mobx.extendObservable(a,c),a}},{key:"onFilterListChange",value:function(){this.callOnChange(),!0==this.config.searchOnChange&&this.startSearch()}},{key:"callOnChange",value:function(){"function"==typeof this.config.callBacks.onChange&&this.config.callBacks.onChange()}},{key:"onColumnSelected",value:function(a){var b=this;this.selectColumn(a.detail.newValueObject),this.columnSelectConfig.triggers.resetStates(),setTimeout(function(){return b.autoSize()},0)}},{key:"selectColumn",value:function(a){"function"==typeof this.config.callBacks.oncolumnSelect&&this.config.callBacks.oncolumnSelect(a),this.intentColumn=a}},{key:"onListValueSelected",value:function(a){var b=this.intentColumn;this.intentValue.caption=a.detail.newValueObject[b.config.fieldsNames.caption]||this.config.captions.unknownSelectedOptionCaption,this.intentValue.value=null!=a.detail.newValueObject[b.config.fieldsNames.value]&&null!=a.detail.newValueObject[b.config.fieldsNames.value]?a.detail.newValueObject[b.config.fieldsNames.value]:this.config.captions.unknownSelectedOptionValue,this.intentValue.isValid=!0}},{key:"onTextValueChange",value:function(a){var b=a.target.value;return this.intentValue.caption=b,this.intentValue.value=b,this.intentValue.isValid=!!(0<b.trim().length),!0}},{key:"onNumberValueChange",value:function(a){var b=a.target.value;return this.intentValue.caption=b,this.intentValue.value=b,this.intentValue.isValid=""!=b,!0}},{key:"onDateValueChange",value:function(a){this.intentValue.value=a.target.value,this.intentValue.caption=a.detail.jalaliDateObj.year+"/"+a.detail.jalaliDateObj.month+"/"+a.detail.jalaliDateObj.day,this.intentValue.isValid=a.detail.isValid,this.intentValue.errorMessage=a.detail.errorMessage}},{key:"manageHiddenColumn",value:function(){var a=this;this.config.columns.forEach(function(b){b.maxUsageCount||(b.maxUsageCount=1/0);var c=a.filterList.filter(function(a){return a.column.id==b.id}).length;b.JBSelectBoxDetail.externalHidden=!(b.maxUsageCount>c)})}},{key:"confirmIntent",value:function(){if(!0==this.intentValue.isValid){var a={columnCaption:this.intentColumn.caption,valueCaption:this.intentValue.caption,column:_objectSpread({},this.intentColumn),value:_objectSpread({},this.intentValue)};this._addFilterToList(a),this.resetIntent()}else this.intentValue.errorMessage&&""!=this.intentValue.errorMessage?alert(this.intentValue.errorMessage):alert("\u0645\u0642\u062F\u0627\u0631 \u0648\u0627\u0631\u062F \u0634\u062F\u0647 \u0635\u062D\u06CC\u062D \u0646\u0645\u06CC\u0628\u0627\u0634\u062F")}},{key:"injectFilterToList",value:function(a){var b=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],c=this.config.columns.find(function(b){return b.id==a.columnId});if("object"!=_typeof(c))return console.error("the filter you intended to add has invalid \"columnId\""),!1;var d={columnCaption:c.caption,valueCaption:a.valueCaption,column:c,value:{caption:a.valueCaption,value:a.value,isValid:!0}};this._addFilterToList(d,b)}},{key:"_addFilterToList",value:function(a){var b=this,c=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.filterList.push(a),this._isComponentMounted&&this.manageHiddenColumn(),c&&this.onFilterListChange(),setTimeout(function(){return b.autoSize()},0)}},{key:"removeFilterFromList",value:function(a,b){var c=this;this.filterList.splice(b,1),this.onFilterListChange(),this.manageHiddenColumn(),setTimeout(function(){return c.autoSize()},0)}},{key:"cancelIntentColumn",value:function(){this.resetIntent()}},{key:"resetIntent",value:function(){switch(this.intentValue={caption:"",value:null,isValid:!1},this.intentColumn.type){case"list":break;case"text":break;case"number":break;case"date":}this.intentColumn=null}},{key:"onFilterBtnClick",value:function(){!0==this.intentValue.isValid&&this.confirmIntent(),this.isLoading||this.startSearch()}},{key:"startSearch",value:function(){this._isComponentMounted&&(this.callOnSearchCallBack(),this.playSearchIconAnimation())}},{key:"playSearchIconAnimation",value:function(){var a=this,b=this.elements.spinnerLine.current.animate([{d:"path(\"M400 400 L 450 450\")"},{d:"path(\"M410 410 L 415 415\")"}],{id:"ShrinkLine",duration:400});b.cancel();b.onfinish=function(){a.elements.spinnerLine.current.setAttribute("d","M 407.82484150097946 413.25475607450323 A 220 220 0 0 0 413.25475607450323 407.8248415009794"),c.play()};var c=this.elements.spinnerLine.current.animate([{d:"path(\"M 407.82484150097946 413.25475607450323 A 220 220 0 0 0 413.25475607450323 407.8248415009794\")"},{d:"path(\"M 255 475 A 220 220 0 0 0 475 255\")"}],{id:"CurveLine",duration:400});c.cancel();c.onfinish=function(){a.elements.spinnerLine.current.setAttribute("d","M 255 475 A 220 220 0 0 0 475 255"),d.play()};var d=this.elements.spinnerBox.current.animate([{transform:"rotate(0deg)"},{transform:"rotate(180deg)"},{transform:"rotate(360deg)"}],{id:"Spin",duration:1e3,iterations:1});d.cancel();d.onfinish=function(){!0==a.isLoading?d.play():f.play()};var e=this.elements.spinnerLine.current.animate([{d:"path(\"M410 410 L 415 415\")"},{d:"path(\"M400 400 L 450 450\")"}],{id:"GrowLine",uration:400});e.cancel();e.onfinish=function(){a.elements.spinnerLine.current.setAttribute("d","M400 400 L 450 450")};var f=this.elements.spinnerLine.current.animate([{d:"path(\"M 255 475 A 220 220 0 0 0 475 255\")"},{d:"path(\"M 407.82484150097946 413.25475607450323 A 220 220 0 0 0 413.25475607450323 407.8248415009794\")"}],{id:"ReverseCurveLine",duration:400});f.cancel();f.onfinish=function(){a.elements.spinnerLine.current.setAttribute("d","M410 410 L 415 415"),e.play()},b.play()}},{key:"callOnSearchCallBack",value:function(){var a=this;this.isLoading=!0,this.onSearch?this.onSearch(this.filterList).then(function(){a.isLoading=!1}).catch(function(){a.isLoading=!1}):console.error("the onSeach callback function is not definded")}},{key:"onValueInputTextKeyUp",value:function(a){13==a.keyCode&&this.confirmIntent()}},{key:"searchBarFocus",value:function(){this.intentColumn||this.columnSelectConfig.triggers.focus()}},{key:"autoSize",value:function(){var a=this.elements.filterInputWrapper.current.offsetTop,b=this.elements.filterDynamicWrapper.current.offsetTop,c=a-b+45;c!=this.searchBarHeight&&(this.searchBarHeight=c,"function"==typeof this.config.callBacks.onHeightChange&&this.config.callBacks.onHeightChange(c)),a>b&&"function"==typeof this.config.callBacks.onHeightOverflow&&this.config.callBacks.onHeightOverflow(c)}},{key:"onDateInputSubmit",value:function(){this.confirmIntent()}}]),a}(),_temp$1),_descriptor$1=_applyDecoratedDescriptor$1(_class$1.prototype,"intentColumn",[mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_descriptor2=_applyDecoratedDescriptor$1(_class$1.prototype,"intentValue",[mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{caption:"",value:null,isValid:!1,errorMessage:""}}}),_descriptor3=_applyDecoratedDescriptor$1(_class$1.prototype,"filterList",[mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_class$1);function _typeof$1(a){return _typeof$1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof$1(a)}function _classCallCheck$2(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties$2(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass$2(a,b,c){return b&&_defineProperties$2(a.prototype,b),c&&_defineProperties$2(a,c),a}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof$1(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}var JBSearchBar=mobxReact.observer(_class$2=function(a){function b(a){var c;return _classCallCheck$2(this,b),c=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,a)),c.service=new JBSearchBarService(a),c}return _inherits(b,a),_createClass$2(b,[{key:"componentDidMount",value:function(){this.service.onComponentDidMount()}},{key:"render",value:function(){var a=this;return React.createElement("div",{className:"jb-search-bar-component"},React.createElement("section",{className:"filter-dynamic-wrapper",ref:this.service.elements.filterDynamicWrapper},React.createElement("section",{className:"filter-list-section"},this.service.filterList.map(function(b,c){return React.createElement("div",{className:"item",key:"index"},React.createElement("span",{className:"close-icon",onClick:function(){return a.service.removeFilterFromList(b,c)}},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"32",id:"close",viewBox:"0 0 32 32",width:"32"},React.createElement("path",{d:"M4 8 L8 4 L16 12 L24 4 L28 8 L20 16 L28 24 L24 28 L16 20 L8 28 L4 24 L12 16 z"}))),React.createElement("span",null,b.columnCaption,"\xA0:\xA0"),React.createElement("span",null,b.valueCaption))})),React.createElement("section",{className:"filter-input-section",ref:this.service.elements.filterInputWrapper},!this.service.intentColumn&&React.createElement("div",{className:"column-list-wrapper"},React.createElement(JBSelectBox,{config:this.service.columnSelectConfig,onChange:function(b){return a.service.onColumnSelected(b)}})),this.service.intentColumn&&React.createElement("div",{className:"intent-wrapper"},React.createElement("div",{className:"cancel-btn",onClick:function(){a.service.cancelIntentColumn()}},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 378.303 378.303"},React.createElement("polygon",{style:{fill:"#E04F5F"},points:"378.303,28.285 350.018,0 189.151,160.867 28.285,0 0,28.285 160.867,189.151 0,350.018   28.285,378.302 189.151,217.436 350.018,378.302 378.303,350.018 217.436,189.151 "}))),React.createElement("div",{className:"intent-column"},React.createElement("span",null,this.service.intentColumn.caption,":\xA0")),React.createElement("div",{className:"input-field-wrapper"},React.createElement(this.InputFieldWrapper,{column:this.service.intentColumn,value:this.service.intentValue,this:this.service})),React.createElement("div",{onClick:function(b){return a.service.confirmIntent(b)},className:"confirm-btn "+(this.service.intentValue&&this.service.intentValue.isValid?"active":"")},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",id:"Layer_1",x:"0px",y:"0px",viewBox:"0 0 493.464 493.464",xlink:"http://www.w3.org/1999/xlink",space:"preserve"},React.createElement("g",null,React.createElement("g",null,React.createElement("path",{d:"M246.736,0C110.692,0,0.004,110.68,0.004,246.732c0,136.06,110.688,246.732,246.732,246.732    c136.048,0,246.724-110.672,246.724-246.732C493.456,110.68,382.78,0,246.736,0z M360.524,208.716L230.98,338.268    c-2.82,2.824-7.816,2.824-10.64,0l-86.908-86.912c-1.412-1.416-2.192-3.3-2.192-5.324c0.004-2.016,0.784-3.912,2.192-5.336    l11.108-11.104c1.412-1.408,3.3-2.18,5.328-2.18c2.016,0,3.908,0.772,5.316,2.18l67.752,67.752c1.5,1.516,3.94,1.516,5.444,0    l110.392-110.392c2.824-2.824,7.828-2.824,10.644,0l11.108,11.124c1.412,1.4,2.208,3.304,2.208,5.308    C362.732,205.412,361.936,207.3,360.524,208.716z"})))))))),React.createElement("section",{className:"filter-btn",onClick:function(b){return a.service.onFilterBtnClick(b)}},React.createElement("svg",{viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},React.createElement("circle",{cx:"255",cy:"255",r:"170"}),React.createElement("g",{ref:this.service.elements.spinnerBox,className:"spin-line-group"},React.createElement("rect",{x:"0",y:"0",width:"512",height:"512"}),React.createElement("path",{ref:this.service.elements.spinnerLine,className:"convertable-line",d:"M400 400 L 450 450"})))))}},{key:"InputFieldWrapper",value:function(a){var b,c=a.column,d=a.value,f=a.this;switch(c.type){case"text":b=React.createElement("div",{className:"text-input"},React.createElement("input",{ref:f.elements.valueTextInput,onKeyUp:function(a){return f.onValueInputTextKeyUp(a)},type:"text",onChange:function(a){return f.onTextValueChange(a)},autoFocus:!0}));break;case"number":b=React.createElement("div",{className:"text-input"},React.createElement("input",{type:"number",onChange:function(a){return f.onNumberValueChange(a)},onKeyUp:function(a){return f.onValueInputTextKeyUp(a)},autoFocus:!0}));break;case"date":b=React.createElement("div",{className:"date-input"},React.createElement(JBDateInput,{config:c.config,onChange:function(a){return f.onDateValueChange(a)},autoFocus:!0,onSubmit:function(a){f.onDateInputSubmit(a)}}));break;case"list":a.column.config.value=f.intentValue,b=React.createElement("div",{className:"list-input"},React.createElement(JBSelectBox,{value:f.intentValue.value,config:a.column.config,onChange:function(a){f.onListValueSelected(a)},autoFocus:!0}));}return b}}]),b}(React.Component))||_class$2;module.exports=JBSearchBar;
